{% assign page_path = canonical_link | stripe %}

{
  "@context": "https://schema.org",
  "@graph": [
        {
            "@type": "Person",
            "@id": "{{ site.url }}/#/schema/author",
            "name": "{{ site.author.name }}",
            {% if site.author.about %}
              {% assign expertises = site.author.expertises | split: "," %}
              "knowsAbout": [
                {% for expertise in expertises %}
                  "{{ expertise | strip }}"{% if forloop.last == false %},{% endif %}
                {% endfor %}
              ],
            {% endif %}

            {% assign names = site.author.name | split: " " %}
            "givenName": "{{ names[0] }}",
            "familyName": "{{ names[1] }}",
            "jobTitle": {{ site.author.about | jsonify }},
            "image": {
                "@type": "ImageObject",
                "inLanguage": "ru-RU",
                {% assign about_image = site.author.image %}
                "url": "{{ site.url }}{{ about_image }}",
                "width": {% imagesize about_image:width %},
                "height": {% imagesize about_image:height %},
                "contentUrl": "{{ site.url }}{{ about_image }}",
                "caption": "{{ site.author.name }} - {{ site.author.about }}",
                "encodingFormat": "image/webp"
            },
            "gender": "female",
            "alumniOf": {
                "@type": "EducationalOrganization",
                "name": "Саратовская государственная юридическая академия",
                "sameAs": "https://ru.wikipedia.org/wiki/Саратовская_государственная_юридическая_академия"
            },
            "url": "{{ site.url }}{% link about.md %}",
            {% assign contacts = site.data.contact %}
            "sameAs": [
                "{{ site.url }}",
                "{{ contacts.whatsapp }}",
                "{{ contacts.telegram }}"
            ],
            "hasCredential": [
                {
                    "@type": "EducationalOccupationalCredential",
                    "credentialCategory": "Юридический психолог",
                    "educationalLevel": "Высшее образование"
                },
                {
                    "@type": "EducationalOccupationalCredential",
                    "credentialCategory": "Клинический психолог",
                    "educationalLevel": "Высшее образование"
                },
                {
                    "@type": "EducationalOccupationalCredential",
                    "credentialCategory": "Когнитивно-поведенческая психотерапия",
                    "educationalLevel": "Высшее образование"
                },
                {
                    "@type": "EducationalOccupationalCredential",
                    "credentialCategory": "Тренер навыков ДБТ",
                    "educationalLevel": "Высшее образование"
                }
            ],
            "contactPoint": {
                "@type": "ContactPoint",
                "contactType": "Консультации и запись",
                "email": "{{site.data.contact.email}}",
                "availableLanguage": ["ru"]
            }
       },
    {% if page.is_about != "true" %}
      {
        "@type": "Article",
        "@id": "{{ page_path }}#article",
        "isPartOf": {
            "@id": "{{ page_path }}"
        },
        "author": {
            "@id": "{{ site.url }}/#/schema/author"
        },
        {% if page.description %}
            "description": {{ page.description | jsonify }},
        {% else %}
            "description": {{ site.description | jsonify }},
        {% endif %}
        "headline": {{ page.title | default: site.title | jsonify }},
        "datePublished": "{{ page.date | date_to_xmlschema }}",
        "dateModified": "{{ site.time | date_to_xmlschema }}",
        "url":  "{{ canonical_link }}",
        "mainEntityOfPage": {
            "@id": "{{ page_path }}"
        },
        "wordCount": {{ page.content | number_of_words }},
        "publisher": {
            "@id": "{{ site.url }}/#organization"
        },
        "image": {
            "@id": "{{ page_path }}#primaryimage"
        },
        {% if page.image %}
            "thumbnailUrl": "{{site.url}}{{ page.image }}",
        {% else %}
            "thumbnailUrl": "{{site.url}}{{ site.image }}",
        {% endif %}
        "inLanguage": "ru-RU",
        "copyrightYear": {{ page.date | date: "%Y" | }},
        "copyrightHolder": {
          "@id": "{{ site.url }}/#organization"
        }
        {% if page.video %}
          ,
          "video": [
            {
              "@id": "{{ page_path }}#video"
            }
          ]
        {% endif %}
        {% if page.keywords %}
          ,
          {% assign keywords_array = page.keywords | split: "," %}
          "keywords": [
            {% for keyword in keywords_array %}
              "{{ keyword | strip }}"{% if forloop.last == false %},{% endif %}
            {% endfor %}
          ]
        {% endif %}
      },
    {% endif %}
    {
      "@type": "WebPage",
      "@id": "{{ page_path }}",
      "url": "{{ canonical_link }}",
      "name": {{ page.title | default: site.title | jsonify }},
      "isPartOf": {
        "@id": "{{ site.url }}/#website"
      },
      "primaryImageOfPage": {
        "@id": "{{ page_path }}#primaryimage"
      },
      "image": {
        "@id": "{{ page_path }}#primaryimage"
      },
      {% if page.image %}
          "thumbnailUrl": "{{ site.url }}{{ page.image }}",
      {% else %}
          "thumbnailUrl": "{{ site.url }}{{ site.image }}",
      {% endif %}
      "datePublished": "{{ page.date | date_to_xmlschema }}",
      "dateModified": "{{ site.time | date_to_xmlschema }}",
      {% if page.description %}
          "description": {{ page.description | jsonify }},
      {% else %}
          "description": {{ site.description | jsonify }},
      {% endif %}
      "breadcrumb": {
        "@id": "{{ page_path }}#breadcrumb"
      },
      "inLanguage": "ru-RU",
      "potentialAction": [
        {
          "@type": "ReadAction",
          "target": [
            "{{ canonical_link }}"
          ]
        }
      ],
      "author": {
        "@id": "{{ site.url }}/#/schema/author"
      }
      {% if page.video %}
        ,
        "video": [
          {
            "@id": "{{ page_path }}#video"
          }
        ]
      {% endif %}
    },
    {
      "@type": "ImageObject",
      "inLanguage": "ru-RU",
      "@id": "{{ page_path }}#primaryimage",
      {% if page.image %}
        "url": "{{site.url}}{{ page.image }}",
        "contentUrl": "{{site.url}}{{ page.image }}",
        "width": {% imagesize page.image:width %},
        "height": {% imagesize page.image:height %},
        "encodingFormat": "image/webp",
      {% else %}
        {% assign logo_path = "/assets/images/logo/ttm-help-logo.jpg" %}
        "url": "{{ site.url }}{{ logo_path }}",
        "contentUrl": "{{ site.url }}{{ logo_path }}",
        "width": {% imagesize logo_path:width %},
        "height": {% imagesize logo_path:height %},
        "encodingFormat": "image/jpeg",
      {% endif %}
      "caption": {{ page.description | default: site.description | jsonify }}
    },
    {
      "@type": "BreadcrumbList",
      "@id": "{{ page_path }}#breadcrumb",
      "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Главная",
                "item": "{{site.url}}"
            }
            {% if page.layout == "post" %}
            ,{
                "@type": "ListItem",
                "position": 2,
                "name": "Статьи",
                "item": "{{ site.url }}{% link posts.md %}"
            },
            {% for site_category in site.data.categories.list %}
                {% if site_category.name == page.category %}
                        {
                          "@type": "ListItem",
                          "position": 3,
                          "name": "{{ site_category.name }}",
                          "item": "{{ site.url }}{{ site_category.url }}"
                        },
                {% endif %}
            {% endfor %}
            {
                "@type": "ListItem",
                "position": 4,
                "name": {{ page.title | jsonify }},
                "item": "{{ canonical_link }}"
            }
            {% elsif page.url != "/" %}
            ,{
                "@type": "ListItem",
                "position": 2,
                "name": {{ page.title | jsonify }},
                "item": "{{ canonical_link }}"
            }
            {% endif %}
      ]
    },
    {
        "@type": "WebSite",
        "@id": "{{ site.url }}/#website",
        "url": "{{ site.url }}",
        "name": {{ site.title | jsonify }},
        "description": {{ site.description | jsonify  }},
        "publisher": {
          "@id": "{{ site.url }}/#organization"
        },
        "inLanguage": "ru-RU"
    },
    {
        "@type": "ImageObject",
        "inLanguage": "ru-RU",
        "@id": "{{ site.url }}/#/schema/logo/image",
        {% assign logo_path = '/assets/images/logo/ttm-help-logo.jpg' %}
        "url": "{{ site.url }}{{ logo_path }}",
        "contentUrl": "{{ site.url }}{{ logo_path }}",
        "width": {% imagesize logo_path:width %},
        "height": {% imagesize logo_path:height %},
        "caption": {{ site.description | jsonify }},
        "encodingFormat": "image/jpeg"
    },
    {
        "@type": "Organization",
        "@id": "{{ site.url }}/#organization",
        "name": "Проект TTM HELP",
        "url": "{{ site.url }}",
        "logo": {
          "@id": "{{ site.url }}/#/schema/logo/image"
        },
        "sameAs": [
            {% for item in site.data.social %}
                "{{ item.link }}"
                {% if forloop.last == false %}
                  ,
                {% endif %}
            {% endfor %}
        ],
        "image": {
          "@id": "{{ site.url }}/#/schema/logo/image"
        }
    }
    {% if page.video %}
    ,
    {
        "@type": "VideoObject",
        "@id": "{{ page_path }}#video",
        "name": {{ page.title | default: site.title | jsonify }},
        "isPartOf": {
          "@id": "{{ page_path }}#article"
        },
        "thumbnailUrl": "{{site.url}}{{ page.image }}",
        "description": {{ page.description | default: site.description | jsonify }},
        "uploadDate": "{{ page.date | date_to_xmlschema }}",
        "width": 1280,
        "height": 720,
        {% if page.video.url contains "youtube" %}
          "embedUrl": "{{ page.video.url }}",
        {% else %}
          "contentUrl": "{{ site.url }}{{ page.video.url }}",
        {% endif %}
        "duration": "{{ page.video.duration }}",
        "isFamilyFriendly": true,
        "inLanguage": "ru-RU"
    }
    {% endif %}

    {% assign sorted_posts = site.categories[page.category] | where_exp: "post", "post.title != page.title" | sample:4 %}
    {% if sorted_posts and sorted_posts.size < 4 %}
        {% assign sorted_posts = site.posts | where_exp: "item", "item.title!= page.title" | sample:4 %}
    {% endif %}
    {% if sorted_posts.size > 0 %}
    ,
    {
        "@type": "ItemList",
        "@id": "{{ page_path }}#related",
        "isPartOf": {
            "@id": "{{ page_path }}#article"
        },
        "name": "Похожие статьи о {{ page.category | smartify }}",
        "itemListElement": [
        {% for item in sorted_posts %}
            {
                "@type": "ListItem",
                "position": {{ forloop.index }},
                "url": "{{ site.url }}{{ item.url }}"
            }
            {% if forloop.last == false %}
                ,
            {% endif %}
        {% endfor %}
        ]
    }
    {% endif %}
  ]
}