<div class="col mt-4">
    {% assign sorted_posts = "" | split: "" %}

    {% if page.category %}
        {% assign cat_posts = site.categories[page.category]
        | where_exp: "post", "post.title != page.title"
        | sort: "date" | reverse
        %}
        {% assign sorted_posts = cat_posts | slice: 0, 4 %}
    {% endif %}

    {% if sorted_posts.size < 4 %}
        {% assign needed = 4 | minus: sorted_posts.size %}

        {% assign latest_posts = site.posts
        | where_exp: "post", "post.title != page.title"
        | sort: "date" | reverse
        %}

        {% assign sorted_posts = sorted_posts | concat: (latest_posts | slice: 0, needed) %}
    {% endif %}

    {% assign category_url = nil %}
    {% if page.category %}
        {% for site_category in site.data.categories.list %}
            {% if site_category.name == page.category %}
                {% assign category_url = site_category.url %}
            {% endif %}
        {% endfor %}
    {% endif %}

    <div class="row col mb-3">
        <h2 class="weight-bold mb-1">
            {% if page.category %}
                {% if category_url %}
                    <a href="{{ category_url }}" class="text-decoration-none text-black">{{ page.category }}</a>
                {% else %}
                    <a href="{% link posts.md %}" class="text-decoration-none text-black">{{ page.category }}</a>
                {% endif %}
            {% endif %}
        </h2>
    </div>

    <div class="row g-4">
        {% for post in sorted_posts %}
        <div class="col-12 col-md-6 col-lg-3">
            <a href="{{ post.url }}" class="text-decoration-none text-dark">
                <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden article-card">

                    <div class="ratio ratio-16x9">
                        <img src="{{ post.image }}"
                             loading="lazy"
                             decoding="async"
                             alt="{{ post.description | smartify }}"
                             class="card-img-top object-fit-cover">
                    </div>

                    <div class="card-body p-3">
                        <h3 class="h6 fw-semibold mb-2">
                            {{ post.title | smartify }}
                        </h3>

                        {% if post.excerpt %}
                        <p class="text-muted small mb-0">
                            {{ post.excerpt | strip_html | truncate: 90 }}
                        </p>
                        {% endif %}
                    </div>

                </div>
            </a>
        </div>
        {% endfor %}
    </div>

</div>
